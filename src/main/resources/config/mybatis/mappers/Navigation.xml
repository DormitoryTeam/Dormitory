<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.noeasy.money.model.Navigation">

	<select id="queryCountry" resultType="hashmap" parameterType="java.util.Map">
		select id, name, countrycode as countryCode, status
		from country
		where status = 1
		<if test="id != null">
			and id = #{id}
		</if>
		order by id;
	</select>

	<select id="queryCity" resultType="hashmap" parameterType="java.util.Map">
		select id, country_id as countryId, name, status
		from city
		where status = 1
		<if test="id != null">
			and id = #{id}
		</if>
		<if test="countryId != null">
			and country_id = #{countryId}
		</if>
		order by country_id
	</select>

	<select id="queryCollege" resultType="hashmap" parameterType="java.util.Map">
		select id, city_id as cityId, name, status, latitude, longitude, status
		from college
		where status = 1
		<if test="id != null">
			and id = #{id}
		</if>
		<if test="cityId != null">
			and city_id = #{cityId}
		</if>
	</select>

	<select id="queryCityInSameCountry" resultType="hashmap" parameterType="java.util.Map">
		select id, country_id as countryId, name, status
		from city
		where status =
		1
		and country_id = (
		select country_id from city where id = #{id} and status = 1
		)
	</select>

	<select id="queryCountryByCityId" resultType="hashmap" parameterType="int">
		select country.id, country.name, countrycode as countryCode,
		country.status
		from country
		left join city on country.id = city.country_id and city.id
		where
		country.status = 1 and city.status = 1 and city.id =
		#{cityId}
	</select>

	<select id="queryFlight" resultType="hashmap" parameterType="java.util.Map">
		select id, country_id as countryId, city_id as cityId, airportCode as flightNum, name, status
		from airport
		where status = 1
		<if test="countryId != null">
			and country_id = #{countryId}
		</if>
		<if test="cityId != null">
			and city_id = #{cityId}
		</if>
		<if test="flightNum != null">
			and airportCode = #{flightNum}
		</if>
	</select>
	
	<select id="queryCityCollegeByCountryId" resultMap="cityCollege" parameterType="int">
		select t1.id cityId, t1.name cityName, t2.id collegeId, t2.name collegeName, t2.original_name originalName
		from city t1
		left join college t2 on t1.id = t2.city_id
		where t1.status = 1 and t2.status = 1 and t1.country_id = #{countryId}
		group by t2.id
	</select>
	
	<select id="queryCityCollegeByCityId" resultMap="cityCollege" parameterType="int">
		select t1.id cityId, t1.name cityName, t2.id collegeId, t2.name collegeName, t2.original_name originalName
		from city t1
		left join college t2 on t1.id = t2.city_id
		where t1.status = 1 and t2.status = 1 and t1.country_id in
		(
			select country_id from city where id = #{cityId}
		)
		group by t2.id
	</select>
	
	<resultMap id="cityCollege" type="java.util.HashMap">
		<id property="cityId" column="cityId" />
		<result property="cityName" column="cityName" />
		<collection property="colleges" javaType="ArrayList" ofType="java.util.HashMap">
			<result property="collegeId" column="collegeId" />
			<result property="collegeName" column="collegeName" />
			<result property="originalName" column="originalName" />
		</collection>
	</resultMap>
</mapper>